{"name":"ajax","slug":"ajax","count":4,"postlist":[{"title":"关于使用ajax(JavaScript)+Flask(Python)+Canvas 上传画布(Canvas)图片并存储","slug":"ajax-upload-canvas-to-server","date":"2017-10-26T14:31:36.000Z","updated":"2019-07-03T13:51:36.859Z","comments":true,"path":"api/articles/ajax-upload-canvas-to-server.json","excerpt":"","keywords":null,"cover":"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171027191006.png","content":"<p>因为想要做一个todo list的记事本app.其中有一个模块是使用Canvas做涂鸦. <code>其中有两个操作</code>: <code>1.</code>然后上传canvas的画布图片并保存到本地. <code>2.</code>将对应画布的url传给画布,并绘制出来. 首先,Canvas画板的css和js是在Github上淘的一个,链接如下: <code>https://github.com/youknowznm/paint</code><a href=\"https://github.com/youknowznm/paint\" title=\"&lt;code&gt;点击这里&lt;/code&gt;\" target=\"_blank\" rel=\"noopener\"><code>点击这里</code></a> 首先是<code>index.html</code>的代码,大部分是样式,所以不用太在意,只需要注意<code>canvas的id</code>即可.</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;title&gt;paint&lt;/title&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;./paint.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=&quot;canvas-wrapper&quot;&gt;\n        &lt;ul class=&quot;doodle-colors&quot;&gt;\n            &lt;li data-color=&quot;black&quot;&gt;&lt;/li&gt;\n            &lt;li data-color=&quot;green&quot;&gt;&lt;/li&gt;\n            &lt;li data-color=&quot;yellow&quot;&gt;&lt;/li&gt;\n            &lt;li data-color=&quot;red&quot;&gt;&lt;/li&gt;\n            &lt;li data-color=&quot;white&quot;&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n        &lt;ul class=&quot;doodle-controllers&quot;&gt;\n            &lt;li class=&quot;undo&quot;&gt;&lt;/li&gt;\n            &lt;li class=&quot;redo&quot;&gt;&lt;/li&gt;\n            &lt;li class=&quot;clear&quot;&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n        &lt;canvas id=&quot;cv&quot; class=&quot;doodle-content&quot; width=&apos;500&apos; height=&apos;500&apos;&gt;&lt;/canvas&gt;\n    &lt;/div&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;./paint.js&quot;&gt;&lt;/script&gt;\n    &lt;script&gt;\n        window.onload = function() {\n            let canvasEle = $(&apos;.doodle-content&apos;)[0];\n            let colorsEle = $(&apos;.doodle-colors&apos;)[0];\n            let controllersEle = $(&apos;.doodle-controllers&apos;)[0];\n            initCanvas(canvasEle, colorsEle, controllersEle, null);\n        }\n        function oc(){\n            let cav=document.getElementById(&apos;cv&apos;);\n            console.log(cav);\n            let data=cav.toDataURL();\n            console.log(data);\n            let img = document.createElement(&apos;img&apos;);\n            img.src = data;\n            document.body.appendChild(img);\n            let image=cav.toDataURL(&apos;image/jpeg&apos;);\n            window.location=image;\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre><p>注意,我在代码中添加了一个<code>JavaScript函数oc()</code>:</p>\n<pre><code>function oc(){\n    let cav=document.getElementById(&apos;cv&apos;);\n    console.log(cav);\n    let data=cav.toDataURL();\n    console.log(data);\n    let img = document.createElement(&apos;img&apos;);\n    img.src = data;\n    document.body.appendChild(img);\n    let image=cav.toDataURL(&apos;image/jpeg&apos;);\n    window.location=image;\n}</code></pre><p>其中<code>cav.toDataURL(&#39;type&#39;)</code>即可以实现提取当前Canvas中的图片流信息. 然后我们尝试向后台发送Canvas图片的<code>用base64加密的数据</code>. 使用一个<code>Button</code>来发送post信息. 添加<code>&lt;button id=&quot;btn&quot; &gt;123&lt;/button&gt;</code> 为<code>button</code>添加click事件:</p>\n<pre><code>$(function(){\n    $(&apos;#btn&apos;).click(function(){\n        let cav=document.getElementById(&apos;cv&apos;);\n        let image=cav.toDataURL(&apos;image/jpeg&apos;);\n        $.post(&apos;/upload&apos;,{&apos;data&apos;:image,&apos;idx&apos;:223},function(result){\n            let canvasEle = $(&apos;.doodle-content&apos;)[0];\n            let colorsEle = $(&apos;.doodle-colors&apos;)[0];\n            let controllersEle = $(&apos;.doodle-controllers&apos;)[0];\n            initCanvas(canvasEle, colorsEle, controllersEle, result);\n        })\n    })\n})</code></pre><p>其中表单中<code>data</code>为图片加密信息,<code>idx</code>为假想当前记事本的id. 实践.发送post内容如下: <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ截图20171027191006.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171027191006.png\" alt></a> 注意这里只是介绍了前台代码,让大家看一下发送的表单数据,如果没编写后台接受<code>Post</code>的Route的话是会返回<code>404</code>的. 然后在后台的View视图中添加相应的Route:</p>\n<pre><code>from . import main\nfrom flask import Flask,render_template\nfrom flask import make_response,render_template, session, redirect, url_for, current_app,abort,flash,request\nimport json,os,base64  \n\n@main.route(&apos;/upload&apos;,methods=[&apos;POST&apos;])\ndef upLoad():\n    &quot;&quot;&quot;\n    disturbing by jq\n    this method cannot work\n    &quot;&quot;&quot;\n    files=request.values.get(&apos;data&apos;)\n    f=request.form[&apos;data&apos;][23:]\n    ind=request.form[&apos;idx&apos;]\n    imgdata=base64.b64decode(f)\n    file=open(&apos;app/static/&apos;+ind+&apos;.jpg&apos;,&apos;wb&apos;)\n    file.write(imgdata)\n    file.close()\n    return &apos;/static/&apos;+ind+&apos;.jpg&apos;\n\n@main.route(&apos;/show&apos;,methods=[&apos;GET&apos;])\ndef show():\n    return render_template(&apos;index.html&apos;)</code></pre><p>其中用<code>request.values.get(&#39;key&#39;)</code>来获取对应表单的数据.然后用base64算法对获取到的数据进行解码.之后创建一个空文件<code>idx.jpg</code>,将解码后的数据写进去.得到的即为图片. 我们可以看到<code>获取到的data的头有一段非编码部分</code>:</p>\n<pre><code>data:image/jpeg;base64,/9j/4A</code></pre><p>所以我们需要将前面不属于编码的部分去掉. 后台处理代码中:</p>\n<pre><code>f=request.form[&apos;data&apos;][23:]</code></pre><p>即完成了这一任务. 注意在JavaScript用这种方式获取Canvas的时候,开启管道时<code>背景如果是透明</code>,它会在转换成base64时自动补成<code>#fff</code>(纯黑色). 所以我们需要在创建Canvas时将背景染成纯白色<code>#000</code>. 我们在Paint.js中初始化context中加入下面两句:</p>\n<pre><code>// 初始化 context\nvar ctx = canvasEle.getContext(&apos;2d&apos;);\nctx.fillStyle=&quot;#fff&quot;;\nctx.fillRect(0, 0, 500, 500);</code></pre><p>OK,我们获取图片后即为原图了! 至于如何在Canvas中将图片画出来.直接用<code>paint.js</code>中的 <code>initCanvas(canvasEle, colorsEle, controllersEle, result);</code> 即可.result为对应图片的地址<code>一般是发布网站的相对地址</code>. 上传结果: <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ截图20171027193747.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171027193747.png\" alt></a> 最后一个问题: <code>当我们试图读取图片的url时,浏览器多半会返回对应url的缓存图片文件,如何解决这个问题呢?</code> 我们只需要在<code>URL</code>中随便加入一个参数即可,保证每次的url不相同即可,比如:</p>\n<pre><code>URL=URL+&apos;?t=&apos;+Math.random();</code></pre><p>OK,日志本的第一个难题攻关!</p>\n","text":"因为想要做一个todo list的记事本app.其中有一个模块是使用Canvas做涂鸦. 其中有两个操作: 1.然后上传canvas的画布图片并保存到本地. 2.将对应画布的url传给画布,并绘制出来. 首先,Canvas画板的css和js是在Github上淘的一个,链接如下: ","link":"","raw":null,"photos":[],"categories":[{"name":"ajax","slug":"ajax","count":4,"path":"api/categories/ajax.json"},{"name":"Flask","slug":"ajax/Flask","count":1,"path":"api/categories/ajax/Flask.json"},{"name":"Python","slug":"ajax/Flask/Python","count":1,"path":"api/categories/ajax/Flask/Python.json"}],"tags":[{"name":"Flask","slug":"Flask","count":20,"path":"api/tags/Flask.json"},{"name":"Python","slug":"Python","count":65,"path":"api/tags/Python.json"},{"name":"ajax","slug":"ajax","count":4,"path":"api/tags/ajax.json"}]},{"title":"ASP.NET API2 设计 RESTful API 服务端解决跨域","slug":"asp-net-api2-ky-restful-api","date":"2017-11-26T10:16:55.000Z","updated":"2019-07-03T13:51:36.859Z","comments":true,"path":"api/articles/asp-net-api2-ky-restful-api.json","excerpt":"","keywords":null,"cover":null,"content":"<p>原理: 只需要在消息头中添加一句: Access-Control-Allow-Origin * 即可. 解决方案是直接在nuget中安装 Microsoft Asp.Net Web Api 2.2 Cross-Origin 然后在App-Start/WebApiConfig.cs下：</p>\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web.Http;\nusing System.Web.Http.Cors;\n\nnamespace WAPI\n{\n    public static class WebApiConfig\n    {\n        public static void Register(HttpConfiguration config)\n        {\n            //跨域配置\n            config.EnableCors(new EnableCorsAttribute(&quot;*&quot;, &quot;*&quot;, &quot;*&quot;));\n            // Web API configuration and services\n\n            // Web API routes\n            config.MapHttpAttributeRoutes();\n\n            config.Routes.MapHttpRoute(\n                name: &quot;DefaultApi&quot;,\n                routeTemplate: &quot;api/{controller}/{id}&quot;,\n                defaults: new { id = RouteParameter.Optional }\n            );\n        }\n    }\n}</code></pre><p>即可.</p>\n","text":"原理: 只需要在消息头中添加一句: Access-Control-Allow-Origin * 即可. 解决方案是直接在nuget中安装 Microsoft Asp.Net Web Api 2.2 Cross-Origin 然后在App-Start/WebApiConfig.cs","link":"","raw":null,"photos":[],"categories":[{"name":"ajax","slug":"ajax","count":4,"path":"api/categories/ajax.json"},{"name":"ASP.Net","slug":"ajax/ASP-Net","count":3,"path":"api/categories/ajax/ASP-Net.json"},{"name":"C#","slug":"ajax/ASP-Net/C","count":1,"path":"api/categories/ajax/ASP-Net/C.json"},{"name":"RestFul_API","slug":"ajax/ASP-Net/C/RestFul-API","count":1,"path":"api/categories/ajax/ASP-Net/C/RestFul-API.json"}],"tags":[{"name":"ajax","slug":"ajax","count":4,"path":"api/tags/ajax.json"},{"name":"ASP.NET","slug":"ASP-NET","count":6,"path":"api/tags/ASP-NET.json"},{"name":"C#","slug":"C","count":6,"path":"api/tags/C.json"},{"name":"RestFul_API","slug":"RestFul-API","count":2,"path":"api/tags/RestFul-API.json"}]},{"title":"ASP.NET API2 设计 RESTful API","slug":"asp-net-api2-restful-api","date":"2017-11-26T04:12:55.000Z","updated":"2019-07-03T13:51:36.859Z","comments":true,"path":"api/articles/asp-net-api2-restful-api.json","excerpt":"","keywords":null,"cover":"http://be-sunshine.cn/wp-content/uploads/2017/11/QQ%E6%88%AA%E5%9B%BE20171126121235.jpg","content":"<p>Copyright @ <a href=\"https://docs.microsoft.com/en-us/aspnet/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api\" title=\"DocsASP.NETASP.NET Web API\" target=\"_blank\" rel=\"noopener\">DocsASP.NETASP.NET Web API</a> 微软的官方文档</p>\n<blockquote>\n<p>首先是新建ASP.NET api项目 然后是设计Model</p>\n<blockquote>\n<p>Product.cs</p>\n</blockquote>\n</blockquote>\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\n\nnamespace WAPI.Models\n{\n    public class Product\n    {\n        public int Id { get; set; }\n        public string Name { get; set; }\n        public string Category { get; set; }\n        public decimal Price { get; set; }\n    }\n}</code></pre><blockquote>\n<p>编写Controller(路由)</p>\n<blockquote>\n<p>ProductsController.cs</p>\n</blockquote>\n</blockquote>\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Net;\nusing System.Net.Http;\nusing System.Web.Http;\n\nusing WAPI.Models;\n\nnamespace WAPI.Controllers\n{\n    public class ProductsController : ApiController\n    {\n        // XXM =&gt; decimal类型小数\n        Product[] products = new Product[]{\n            new Product{ Id=1,Name=&quot;Tomato Soup&quot;,Category=&quot;Groceries&quot;,Price=1},\n            new Product{ Id=2,Name=&quot;Yo-yo&quot;,Category=&quot;Toys&quot;,Price=3.75M},\n            new Product{ Id=3,Name=&quot;Hammer&quot;,Category=&quot;Hardware&quot;,Price=16.99M}\n        };\n\n        public IEnumerable&lt;Product&gt; GetAllProducts()\n        {\n            return products;\n        }\n\n        public IHttpActionResult GetProduct(int id)\n        {\n            //容器.FirstOrDefault(Boolean) 返回满足条件的第一个元素,如未找到,返回默认值\n            var product = products.FirstOrDefault((p) =&gt; p.Id == id);\n            if (product == null)\n            {\n                //ApiController.NotFound()\n                //即404界面\n                return NotFound();\n            }\n            //正常返回\n            return Ok(product);\n        }\n    }\n}</code></pre><blockquote>\n<p>最后通过编写前端界面,并使用JQuery来实现ajax传输,显示</p>\n<blockquote>\n<p>index.html</p>\n</blockquote>\n</blockquote>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;\n&lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;\n    &lt;title&gt;Product App&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div&gt;\n        &lt;h2&gt;All Products&lt;/h2&gt;\n        &lt;ul id=&quot;products&quot;/&gt;\n    &lt;/div&gt;\n    &lt;div&gt;\n        &lt;h2&gt;Search by ID&lt;/h2&gt;\n        &lt;input type=&quot;text&quot; id=&quot;prodId&quot; size=&quot;5&quot;/&gt;\n        &lt;input type=&quot;button&quot; value=&quot;Search&quot; onclick=&quot;find();&quot;/&gt;\n        &lt;p id=&quot;product&quot;/&gt;\n    &lt;/div&gt;\n\n    &lt;script src=&quot;http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script&gt;\n        var uri = &apos;api/products&apos;;\n\n        $(document).ready(function () {\n            //Send an AJAX request\n            $.getJSON(uri)\n                .done(function (data) {\n                    //On success,&apos;data&apos; contains a list of products.\n                    $.each(data, function (key, item) {\n                        //Add a list item for the product。\n                        $(&apos;&lt;li&gt;&apos;, { text: formatItem(item) }).appendTo($(&apos;#products&apos;));\n                    });\n                });\n        });\n\n\n        function formatItem(item) {\n            return item.Name + &apos;: $&apos; + item.Price;\n        }\n\n        function find() {\n            var id = $(&apos;#prodId&apos;).val();\n            $.getJSON(uri + &apos;/&apos; + id)\n                .done(function (data) {\n                    $(&apos;#product&apos;).text(formatItem(data));\n                })\n                .fail(function (jqXHR, textStatus, err) {\n                    $(&apos;#product&apos;).text(&apos;Error: &apos; + err);\n                });\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre><blockquote>\n<p>结果如下所示</p>\n</blockquote>\n<p><a href=\"http://be-sunshine.cn/wp-content/uploads/2017/11/QQ截图20171126121235.jpg\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/11/QQ%E6%88%AA%E5%9B%BE20171126121235.jpg\" alt></a></p>\n","text":"Copyright @ DocsASP.NETASP.NET Web API 微软的官方文档首先是新建ASP.NET api项目 然后是设计ModelProduct.csusing System;using System.Collections.Generic;using Sys","link":"","raw":null,"photos":[],"categories":[{"name":"ajax","slug":"ajax","count":4,"path":"api/categories/ajax.json"},{"name":"ASP.Net","slug":"ajax/ASP-Net","count":3,"path":"api/categories/ajax/ASP-Net.json"},{"name":"JS","slug":"ajax/ASP-Net/JS","count":1,"path":"api/categories/ajax/ASP-Net/JS.json"},{"name":"RestFul_API","slug":"ajax/ASP-Net/JS/RestFul-API","count":1,"path":"api/categories/ajax/ASP-Net/JS/RestFul-API.json"}],"tags":[{"name":"ajax","slug":"ajax","count":4,"path":"api/tags/ajax.json"},{"name":"ASP.NET","slug":"ASP-NET","count":6,"path":"api/tags/ASP-NET.json"},{"name":"RestFul_API","slug":"RestFul-API","count":2,"path":"api/tags/RestFul-API.json"},{"name":"JS","slug":"JS","count":5,"path":"api/tags/JS.json"}]},{"title":"ASP.NET MVC 搭建博客 Song Of The Sea","slug":"asp-net-mvc-song-of-the-sea","date":"2017-12-26T01:01:15.000Z","updated":"2019-07-03T13:51:36.860Z","comments":true,"path":"api/articles/asp-net-mvc-song-of-the-sea.json","excerpt":"","keywords":null,"cover":"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232801.jpg","content":"<h1><span id=\"第五个博客上线了\">第五个博客上线了!</span></h1><p>这次使用的是ASP.NET MVC + Bootstrap3 + SignalR + 百度地图api + ajax无刷新更新页面等等…. 目标: Demo : <a href=\"http://hsdog.be-sunshine.cn\" target=\"_blank\" rel=\"noopener\">http://hsdog.be-sunshine.cn</a> ASP搭建的一个博客(部分重构之前python写的博客,大部分新添加的内容):一只划水狗 但本网站仅供交流和娱乐学习用,因为没有对标签进行处理,所以很容易就会被攻陷的.回头有空了在添加标签过滤功能. :) 代码等回头有空的时候放上来~ 预览: <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ截图20171225232801.jpg\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232801.jpg\" alt></a> <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ截图20171225232601.jpg\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232601.jpg\" alt></a> <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ截图20171225232333.jpg\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232333.jpg\" alt></a> <a href=\"http://hsdog.be-sunshine.cn\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232359.jpg\" alt></a> <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ截图20171225232410.jpg\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/12/QQ%E6%88%AA%E5%9B%BE20171225232410.jpg\" alt></a></p>\n","text":"第五个博客上线了!这次使用的是ASP.NET MVC + Bootstrap3 + SignalR + 百度地图api + ajax无刷新更新页面等等…. 目标: Demo : http://hsdog.be-sunshine.cn ASP搭建的一个博客(部分重构之前python","link":"","raw":null,"photos":[],"categories":[{"name":"ajax","slug":"ajax","count":4,"path":"api/categories/ajax.json"},{"name":"ASP.Net","slug":"ajax/ASP-Net","count":3,"path":"api/categories/ajax/ASP-Net.json"},{"name":"Bootstrap","slug":"ajax/ASP-Net/Bootstrap","count":1,"path":"api/categories/ajax/ASP-Net/Bootstrap.json"},{"name":"C#","slug":"ajax/ASP-Net/Bootstrap/C","count":1,"path":"api/categories/ajax/ASP-Net/Bootstrap/C.json"},{"name":"JS","slug":"ajax/ASP-Net/Bootstrap/C/JS","count":1,"path":"api/categories/ajax/ASP-Net/Bootstrap/C/JS.json"},{"name":"MVC","slug":"ajax/ASP-Net/Bootstrap/C/JS/MVC","count":1,"path":"api/categories/ajax/ASP-Net/Bootstrap/C/JS/MVC.json"}],"tags":[{"name":"ajax","slug":"ajax","count":4,"path":"api/tags/ajax.json"},{"name":"ASP.NET","slug":"ASP-NET","count":6,"path":"api/tags/ASP-NET.json"},{"name":"C#","slug":"C","count":6,"path":"api/tags/C.json"},{"name":"Web","slug":"Web","count":7,"path":"api/tags/Web.json"}]}]}