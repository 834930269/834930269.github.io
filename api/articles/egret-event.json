{"title":"Egret事件","slug":"egret-event","date":"2017-10-01T06:48:46.000Z","updated":"2019-07-03T13:51:36.853Z","comments":true,"path":"api/articles/egret-event.json","photos":[],"link":"","excerpt":null,"covers":["http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171001144253.png","http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171001151826.png"],"content":"<p>先贴跟随书上的问题代码: 项目截图: <img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171001144253.png\" alt=\"Aaron\"> 代码:</p>\n<pre><code>//Circle.ts\nclass Circle extends egret.Sprite{\n    public constructor(cx:number,cy:number,cr:number){\n        super();\n        this.init(cx,cy,cr);\n    }\n    private shape:egret.Shape;\n    private shapex:number;\n    private shapey:number;\n    private shaper:number;\n    private color:number;\n    public static Event_Click:string=&quot;event_click&quot;;\n    private colorList = [13408665, 16777113, 6710937, 16750848, 16776960, 39372, 13421721, 13382553, 10079232, 16737894, 16776960, 3381708, 13395456, 10066329, 13421619, 16750899, 16777164, 39219, 39372, 13421772, 16737894, 16737792, 16777062, 39270, 13395507, 16764057, 13395456, 13369446, 39321, 16763955];\n    private randmColor():number{\n        return this.colorList[Math.round(Math.random()*this.colorList.length)];\n    }\n    private init(cx:number,cy:number,cr:number){\n        this.color=this.randmColor();\n        this.shape=new egret.Shape();\n        this.shape.graphics.beginFill(this.color);\n        this.shape.graphics.drawCircle(0,0,cr);\n        this.shape.graphics.endFill();\n        //设定矢量圆的位置为父类中心点\n        this.shape.x=-cr;\n        this.shape.y=-cr;\n\n        this.shapex=cx;\n        this.shapey=cy;\n        this.shaper=cr;\n        this.touchEnabled=!0;\n\n        //侦听用户的移动与触摸事件\n        this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this,!1);\n        this.addChild(this.shape);\n        this.x=cx;\n        this.y=cy;\n    }\n    private onTouch(e:egret.TouchEvent):void{\n        var par=this.parent;\n        par.dispatchEventWith(Circle.Event_Click,false,this.color);\n        this.touchEnabled=!1;\n        var tween:egret.Tween=egret.Tween.get(this);\n        tween.to({alpha:0.1},500,egret.Ease.sineOut);\n        tween.call(function(){\n            this.visible=!1;\n            par.removeChild(this);\n            this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);\n        },this);\n\n        var circleList:Circle[]=[];\n        var tweenList:egret.Tween[]=[];\n        var redius:number=this.shaper&gt;&gt;1;\n        var tempx:number;\n        var tempy:number;\n        var tempr:number;\n\n        var g:number=0;\n        for(var i:number=0;i&lt;2;++i){\n            for(var t:number=0;t&lt;2;++t){\n                tempx=this.shapex-this.shaper+redius*2*t;\n                tempy=this.shapey-this.shaper+redius*2*i;\n                circleList[g]=new Circle(tempx,tempy,redius);\n                circleList[g].alpha=0.1;\n                circleList[g].scaleX=0.8;\n                circleList[g].scaleY=0.8;\n                par.addChild(circleList[g]);\n                tweenList[g]=egret.Tween.get(circleList[g]);\n                tweenList[g].to({alpha:1,scaleX:1,scaleY:1},1000,egret.Ease.sineIn);\n                g++;\n            }\n        }\n\n    }\n}\n\n\n\n//Main.ts\n    public constructor() {\n        super();\n        this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);\n        this.addEventListener(Circle.Event_Click,this.onClickCircle,this);\n    }\n\n    private textCount:egret.TextField;\n    private textTimer:egret.TextField;\n    private textDes:egret.TextField;\n    private timer:egret.Timer;\n    private color:number; \n\n    private onAddToStage(event: egret.Event) {\n        var stageW:number=this.stage.stageWidth;\n        var stageH:number=this.stage.stageHeight;\n\n        var bg=new egret.Shape();\n        bg.graphics.beginFill(0xfccfcc);\n        bg.graphics.drawRect(0,0,stageW,stageH);\n        bg.graphics.endFill();\n\n        this.textCount=new egret.TextField();\n        this.textCount.textColor=0xffffff;\n        this.textCount.y=630;\n        this.textCount.text=&quot;分数 : 0&quot;;\n\n        this.textTimer=new egret.TextField();\n        this.textTimer.textColor=0xffffff;\n        this.textTimer.y=720;\n        this.textTimer.text=&quot;倒计时&quot;;\n\n        this.textDes=new egret.TextField();\n        this.textDes.text=&quot;点击第一个颜色开始&quot;;\n        this.textDes.y=800;\n\n        this.textCount.textAlign=\n            this.textTimer.textAlign=\n                this.textDes.textAlign=\n                    egret.HorizontalAlign.CENTER;\n\n        this.textCount.width=\n            this.textDes.width=\n                this.textTimer.width=stageW;\n\n        this.textCount.textColor=\n            this.textDes.textColor=\n                this.textTimer.textColor=0x000000;\n\n        this.addChild(bg);\n        this.addChild(this.textCount);\n        this.addChild(this.textDes);\n        this.addChild(this.textTimer);\n\n        this.timer=new egret.Timer(1000,30);\n        this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this);\n        this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this);\n\n        var radius:number=60;\n        for(var i:number=0;i&lt;4;++i){\n            for(var t:number=0;t&lt;4;++t){\n                var tempx:number=200+radius*2*t;\n                var tempy:number=190+radius*2*i;\n                var circle:Circle=new Circle(tempx,tempy,radius);\n                this.addChild(circle);\n            }\n        }\n    }\n\n    private count:number=0;\n    private onClickCircle(e:any):void{\n        //e是触发时的事件对象\n        console.log(e,this.color,&quot;   &quot;,e.data);\n        if(this.count==0){\n            this.color=e.data;\n            //console.log(e,&quot;   &quot;,e.data);\n            this.textCount.text=&quot;分数 : &quot;+(++this.count);\n            this.timer.start();\n        }else if(this.color==e.data){\n            this.textCount.text=&quot;分数 : &quot;+(++this.count);\n        }\n    }\n\n    private onTimer(e:egret.TimerEvent):void{\n        this.textTimer.text=&quot;倒计时 : &quot;+(this.timer.repeatCount-this.timer.currentCount);\n    }\n\n    private onTimerComplete(e:egret.TimerEvent):void{\n        this.textDes.text=&quot;这不是极限,刷新再来一次! &quot;;\n        this.removeEventListener(Circle.Event_Click,this.onClickCircle,this);\n    }</code></pre><p>其中我不解的是</p>\n<pre><code>e:any</code></pre><p>和</p>\n<pre><code>e.data</code></pre><p>为什么是color:number类型的.所以准备系统搞一遍Event. **------------ 1.开始… 首先是构造函数中的三个参数，type、bubbles和cancelable。</p>\n<pre><code>type:触发事件的类型.\nbubbles:是指定事件是否参与事件流的冒泡阶段，关于事件流，会在后面的小节中介绍。\ncancelable:表示是否要取消Event对象。</code></pre><p>这里我们用约会的例子来说明一下. 首先定义一个约会的类:</p>\n<pre><code>class DateEvent extends egret.Event\n{\n    public static DATE:string = &quot;约会&quot;;\n    public _year:number = 0;\n    public _month:number = 0;\n    public _date:number = 0;\n    public _where:string = &quot;&quot;;\n    public _todo:string = &quot;&quot;;\n    public constructor(type:string, bubbles:boolean=false, cancelable:boolean=false)\n    {\n        super(type,bubbles,cancelable);\n    }\n}</code></pre><p>其中</p>\n<pre><code>static DATE:string</code></pre><p>代表DATE事件. **------------ 2.侦听器 事件侦听器也就是事件的处理者，负责接收事件携带的信息，并在接收到该事件后执行特定的代码。 Egret中，事件的侦听器必须是一个函数。事件的发送者必须是 egret.EventDispatcher 类或者子类的实例。只有事件发送者才能侦听事件，并且可以 注册侦听器。 注册侦听器:addEventListener(). 侦听器的定义:</p>\n<pre><code>public addEventListener(type:string, listener:Function, thisObject:any, useCapture:boolean = false, priority:number = 0)</code></pre><p>type: 事件类型. listener: 用来处理事件的侦听器,即函数. thisObject: this即可. 注册侦听器: 事件发送者.addEventListener(事件类型, 侦听器, this); 移除侦听器: 事件发送者.removeEventListener(事件类型, 侦听器, this); 最后一个 priority 参数的设置即侦听器的优先级. 而 侦听器 有一个参数是 e:Event.或者 e:any. e.data 即为发送过来的数据. 在项目中 Circle 有这样一个句:</p>\n<pre><code>par.dispatchEventWith(Circle.Event_Click,false,this.color);</code></pre><p>即当事件触发时 打包发送 this.color. 将其改为 0Xffffff 试试: <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171001151826.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/QQ%E6%88%AA%E5%9B%BE20171001151826.png\" alt></a> 果然如此. 问题解决!****</p>\n","categories":[{"name":"Egret","slug":"Egret","count":3,"path":"api/categories/Egret.json"}],"tags":[{"name":"Egret","slug":"Egret","count":3,"path":"api/tags/Egret.json"}]}