{"title":"Python Flask(三) Python Database Frameworks","slug":"python-flask-python-database-frameworks","date":"2017-10-09T14:07:40.000Z","updated":"2019-07-03T13:51:36.858Z","comments":true,"path":"api/articles/python-flask-python-database-frameworks.json","photos":[],"link":"","excerpt":null,"covers":["http://be-sunshine.cn/wp-content/uploads/2017/10/%E6%8D%95%E8%8E%B75.png"],"content":"<p>期间遇到两个错误,其一,因为<code>Python版本是3.*</code>,所以调用flask_sqlalchemy后执行时出错,因为<code>缺少了MySQLdb模块</code>. 在stackoverflow上面找到了解决办法. <a href=\"https://stackoverflow.com/questions/454854/no-module-named-mysqldb\" title=\"Click here: No module named MySQLdb\" target=\"_blank\" rel=\"noopener\">Click here: No module named MySQLdb</a> 然后这是大部分Python扩展库的集合: <a href=\"http://www.lfd.uci.edu/~gohlke/pythonlibs/#mysql-python\" title=\"click here: Unofficial Windows Binaries for Python Extension Packages\" target=\"_blank\" rel=\"noopener\">click here: Unofficial Windows Binaries for Python Extension Packages</a> 解决办法: <code>pip install mysqlclient</code>/<code>conda install mysqlclient</code> 其二: <code>db.create_all</code>时会报<code>warning</code>,无视即可. 其三: 书上给的是用SQLite连接以及创建数据库,直接将连接地址改为Mysql的地址即可.具体代码如下:</p>\n<pre><code>#--*--coding:utf-8--*--\nfrom datetime import datetime\nfrom flask import Flask, render_template,session,redirect,url_for,flash\nfrom flask_script import Manager\nfrom flask_bootstrap import Bootstrap   \nfrom flask_moment import Moment\nfrom flask_wtf import Form\nfrom wtforms import StringField,SubmitField\nfrom wtforms.validators import Required\nfrom flask_sqlalchemy import SQLAlchemy\n\nclass NameForm(Form):\n    name=StringField(&apos;What is your name?&apos;,validators=[Required()])\n    submit=SubmitField(&apos;Submit&apos;)\n\napp = Flask(__name__)\n\n#Flask-WTF : secret_key\n#app.config dict used to save config message.\napp.config[&apos;SECRET_KEY&apos;]=&apos;hard to guess string&apos;\napp.config[&apos;SQLALCHEMY_DATABASE_URI&apos;]=\\\n    &apos;mysql://root:zwt~19970210@localhost/data&apos;\napp.config[&apos;SQLALCHEMY_COMMIT_ON_TEARDOWN&apos;] = True\napp.config[&apos;SQLALCHEMY_TRACK_MODIFICATIONS&apos;] = False\ndb=SQLAlchemy(app)\n\nmanager = Manager(app)\nbootstrap = Bootstrap(app)\nmoment = Moment(app)\n\nclass Role(db.Model):\n    __tablename__ = &apos;roles&apos;\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(64), unique=True)\n    users = db.relationship(&apos;User&apos;, backref=&apos;role&apos;, lazy=&apos;dynamic&apos;)\n\n    def __repr__(self):\n        return &apos;&lt;Role %r&gt;&apos; % self.name\n\n\nclass User(db.Model):\n    __tablename__ = &apos;users&apos;\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(64), unique=True, index=True)\n    role_id = db.Column(db.Integer, db.ForeignKey(&apos;roles.id&apos;))\n\n    def __repr__(self):\n        return &apos;&lt;User %r&gt;&apos; % self.username\n@app.errorhandler(404)\ndef page_not_found(e):\n    return render_template(&apos;404.html&apos;), 404\n\n\n@app.errorhandler(500)\ndef internal_server_error(e):\n    return render_template(&apos;500.html&apos;), 500\n\n\n@app.route(&apos;/&apos;,methods=[&apos;GET&apos;,&apos;POST&apos;])\ndef index():\n    form=NameForm()\n    if form.validate_on_submit():\n        old_name=session.get(&apos;name&apos;)\n        if old_name is not None and old_name!=form.name.data:\n            flash(&apos;Looks like you have changed your name!&apos;)\n        session[&apos;name&apos;]=form.name.data\n        return redirect(url_for(&apos;index&apos;))\n    return render_template(&apos;index.html&apos;,\n                           current_time=datetime.utcnow(),form=form,name=session.get(&apos;name&apos;))\n\n\n@app.route(&apos;/user/&lt;name&gt;&apos;)\ndef user(name):\n    return render_template(&apos;user.html&apos;, name=name)\n\n\nif __name__ == &apos;__main__&apos;:\n    db.create_all()\n    manager.run()</code></pre><p>其中,只需要修改<code>app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;]=&#39;mysql://root:zwt~19970210@localhost/data&#39;</code>即可修改连接的数据库. 其四: 想要提交操作事务,需要先将操作示例放置在全局db.session字典中. 其五: 一些操作 <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/10/%E6%8D%95%E8%8E%B75.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/%E6%8D%95%E8%8E%B75.png\" alt></a> <a href=\"http://be-sunshine.cn/wp-content/uploads/2017/10/%E6%8D%95%E8%8E%B76.png\" target=\"_blank\" rel=\"noopener\"><img src=\"http://be-sunshine.cn/wp-content/uploads/2017/10/%E6%8D%95%E8%8E%B76.png\" alt></a> Done</p>\n","categories":[{"name":"Flask","slug":"Flask","count":18,"path":"api/categories/Flask.json"},{"name":"Python","slug":"Flask/Python","count":16,"path":"api/categories/Flask/Python.json"}],"tags":[{"name":"Flask","slug":"Flask","count":20,"path":"api/tags/Flask.json"},{"name":"Python","slug":"Python","count":65,"path":"api/tags/Python.json"}]}