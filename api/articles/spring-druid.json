{"title":"使用Spring(胶水框架)粘贴druid","slug":"spring-druid","date":"2019-02-03T09:40:59.000Z","updated":"2019-07-03T13:51:36.864Z","comments":true,"path":"api/articles/spring-druid.json","photos":[],"link":"","excerpt":null,"covers":["http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203175906.png","http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203182905.png"],"content":"<h1 id=\"完善druid所需配置-myshop-properties\"><a href=\"#完善druid所需配置-myshop-properties\" class=\"headerlink\" title=\"完善druid所需配置 myshop.properties\"></a>完善druid所需配置 myshop.properties</h1><pre><code>#============================#\n#==== Database settings ====#\n#============================#\n# JDBC\n# MySQL 8.x: com.mysql.cj.jdbc.Driver\njdbc.driverClass=com.mysql.jdbc.Driver\njdbc.connectionURL=jdbc:mysql://127.0.0.1:3306/myshop?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false\njdbc.username=你的用户\njdbc.password=你的密码\n\n# JDBC Pool\n# 初始化池的数量\njdbc.pool.init=1\n# 最小数量\njdbc.pool.minIdle=3\n# 最大可活动数量\njdbc.pool.maxActive=20\n\n# JDBC Test\njdbc.testSql=SELECT &apos;x&apos; FROM DUAL</code></pre><h1 id=\"建立-spring-context-druid-xml\"><a href=\"#建立-spring-context-druid-xml\" class=\"headerlink\" title=\"建立 spring-context-druid.xml\"></a>建立 spring-context-druid.xml</h1><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;\n       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;\n\n    &lt;!-- 加载配置属性文件 --&gt;\n    &lt;context:property-placeholder ignore-unresolvable=&quot;true&quot; location=&quot;classpath:myshop.properties&quot;/&gt;\n\n    &lt;!-- 数据源配置, 使用 Druid 数据库连接池 --&gt;\n    &lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;\n        &lt;!-- 数据源驱动类可不写，Druid默认会自动根据URL识别DriverClass --&gt;\n        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClass}&quot;/&gt;\n\n        &lt;!-- 基本属性 url、user、password --&gt;\n        &lt;property name=&quot;url&quot; value=&quot;${jdbc.connectionURL}&quot;/&gt;\n        &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;\n        &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;\n\n        &lt;!-- 配置初始化大小、最小、最大 --&gt;\n        &lt;property name=&quot;initialSize&quot; value=&quot;${jdbc.pool.init}&quot;/&gt;\n        &lt;property name=&quot;minIdle&quot; value=&quot;${jdbc.pool.minIdle}&quot;/&gt;\n        &lt;property name=&quot;maxActive&quot; value=&quot;${jdbc.pool.maxActive}&quot;/&gt;\n\n        &lt;!-- 配置获取连接等待超时的时间 --&gt;\n        &lt;property name=&quot;maxWait&quot; value=&quot;60000&quot;/&gt;\n\n        &lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;\n        &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;60000&quot;/&gt;\n\n        &lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;\n        &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot;/&gt;\n\n        &lt;property name=&quot;validationQuery&quot; value=&quot;${jdbc.testSql}&quot;/&gt;\n        &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot;/&gt;\n        &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot;/&gt;\n        &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot;/&gt;\n\n        &lt;!-- 配置监控统计拦截的filters --&gt;\n        &lt;property name=&quot;filters&quot; value=&quot;stat&quot;/&gt;\n    &lt;/bean&gt;\n&lt;/beans&gt;</code></pre><h2 id=\"加载配置属性文件-properties\"><a href=\"#加载配置属性文件-properties\" class=\"headerlink\" title=\"加载配置属性文件(.properties)\"></a>加载配置属性文件(.properties)</h2><blockquote>\n<p>context:property-placeholder</p>\n<blockquote>\n<p>属性:location=classpath:属性文件名字.properties</p>\n</blockquote>\n</blockquote>\n<h2 id=\"基础配置\"><a href=\"#基础配置\" class=\"headerlink\" title=\"基础配置\"></a>基础配置</h2><blockquote>\n<p>在这里开始配置druid,指定数据源时</p>\n<blockquote>\n<p>id=”dataSource” spring-context-*.xml叫做同级别配置</p>\n</blockquote>\n<p>init-method:规定初始化方法 destory-method:规定销毁方法 然后用property标签填充属性</p>\n</blockquote>\n<h2 id=\"druid属性集\"><a href=\"#druid属性集\" class=\"headerlink\" title=\"druid属性集\"></a>druid属性集</h2><p><img src=\"http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203175906.png\" alt></p>\n<h1 id=\"然后在web-xml中修改context-xml的引用方式为\"><a href=\"#然后在web-xml中修改context-xml的引用方式为\" class=\"headerlink\" title=\"然后在web.xml中修改context.xml的引用方式为*\"></a>然后在web.xml中修改context.xml的引用方式为*</h1><pre><code>&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;classpath:spring-context*.xml&lt;/param-value&gt;\n&lt;/context-param&gt;</code></pre><h1 id=\"开启druid监控中心\"><a href=\"#开启druid监控中心\" class=\"headerlink\" title=\"开启druid监控中心\"></a>开启druid监控中心</h1><blockquote>\n<p>将以下配置粘贴到web.xml中</p>\n</blockquote>\n<pre><code>&lt;servlet&gt;\n    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;com.alibaba.druid.support.http.StatViewServlet&lt;/servlet-class&gt;\n&lt;/servlet&gt;\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/druid/*&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;</code></pre><h1 id=\"done\"><a href=\"#done\" class=\"headerlink\" title=\"done\"></a>done</h1><p><img src=\"http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203182905.png\" alt></p>\n","categories":[{"name":"Spring","slug":"Spring","count":4,"path":"api/categories/Spring.json"}],"tags":[{"name":"Spring","slug":"Spring","count":6,"path":"api/tags/Spring.json"}]}