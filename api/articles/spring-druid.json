{"title":"使用Spring(胶水框架)粘贴druid","slug":"spring-druid","date":"2019-02-03T09:40:59.000Z","updated":"2019-07-03T16:10:13.718Z","comments":true,"path":"api/articles/spring-druid.json","photos":[],"link":"","excerpt":"完善druid所需配置 myshop.properties1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>#============================#<br>#==== Database settings ====#<br>#============================#<br># JDBC<br># MySQL 8.x: com.mysql.cj.jdbc.Driver<br>jdbc.driverClass=com.mysql.jdbc.Driver<br>jdbc.connectionURL=jdbc:mysql://127.0.0.1:3306/myshop?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false<br>jdbc.username=你的用户<br>jdbc.password=你的密码<br><br># JDBC Pool<br># 初始化池的数量<br>jdbc.pool.init=1<br># 最小数量<br>jdbc.pool.minIdle=3<br># 最大可活动数量<br>jdbc.pool.maxActive=20<br><br># JDBC Test<br>jdbc.testSql=SELECT 'x' FROM DUAL<br>","covers":["http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203175906.png","http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203182905.png"],"content":"<h1><span id=\"完善druid所需配置-myshopproperties\">完善druid所需配置 myshop.properties</span></h1><figure class=\"highlight julia\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#============================#</span></span><br><span class=\"line\"><span class=\"comment\">#==== Database settings ====#</span></span><br><span class=\"line\"><span class=\"comment\">#============================#</span></span><br><span class=\"line\"><span class=\"comment\"># JDBC</span></span><br><span class=\"line\"><span class=\"comment\"># MySQL 8.x: com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class=\"line\">jdbc.connectionURL=jdbc:mysql://<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">3306</span>/myshop?useUnicode=<span class=\"literal\">true</span>&amp;characterEncoding=utf-<span class=\"number\">8</span>&amp;useSSL=<span class=\"literal\">false</span></span><br><span class=\"line\">jdbc.username=你的用户</span><br><span class=\"line\">jdbc.password=你的密码</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># JDBC Pool</span></span><br><span class=\"line\"><span class=\"comment\"># 初始化池的数量</span></span><br><span class=\"line\">jdbc.pool.init=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\"># 最小数量</span></span><br><span class=\"line\">jdbc.pool.minIdle=<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"comment\"># 最大可活动数量</span></span><br><span class=\"line\">jdbc.pool.maxActive=<span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># JDBC Test</span></span><br><span class=\"line\">jdbc.testSql=SELECT <span class=\"string\">'x'</span> FROM DUAL</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n\n<h1><span id=\"建立-spring-context-druidxml\">建立 spring-context-druid.xml</span></h1><figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span></span><br><span class=\"line\"><span class=\"xml\">       xmlns:context=\"http://www.springframework.org/schema/context\"</span></span><br><span class=\"line\"><span class=\"xml\">       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"&gt;</span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- 加载配置属性文件 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">ignore-unresolvable</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:myshop.properties\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- 数据源配置, 使用 Druid 数据库连接池 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.alibaba.druid.pool.DruidDataSource\"</span> <span class=\"attr\">init-method</span>=<span class=\"string\">\"init\"</span> <span class=\"attr\">destroy-method</span>=<span class=\"string\">\"close\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 数据源驱动类可不写，Druid默认会自动根据URL识别DriverClass --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.driverClass&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 基本属性 url、user、password --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.connectionURL&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.username&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.password&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.pool.init&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minIdle\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.pool.minIdle&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxActive\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.pool.maxActive&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxWait\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"60000\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"timeBetweenEvictionRunsMillis\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"60000\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minEvictableIdleTimeMillis\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"300000\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"validationQuery\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$</span></span></span><span class=\"template-variable\">&#123;jdbc.testSql&#125;</span><span class=\"xml\"><span class=\"tag\"><span class=\"string\">\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"testWhileIdle\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"testOnBorrow\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"testOnReturn\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"comment\">&lt;!-- 配置监控统计拦截的filters --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"filters\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"stat\"</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2><span id=\"加载配置属性文件properties\">加载配置属性文件(.properties)</span></h2><blockquote>\n<p>context:property-placeholder</p>\n<blockquote>\n<p>属性:location=classpath:属性文件名字.properties</p>\n</blockquote>\n</blockquote>\n<h2><span id=\"基础配置\">基础配置</span></h2><blockquote>\n<p>在这里开始配置druid,指定数据源时</p>\n<blockquote>\n<p>id=”dataSource” spring-context-*.xml叫做同级别配置</p>\n</blockquote>\n<p>init-method:规定初始化方法 destory-method:规定销毁方法 然后用property标签填充属性</p>\n</blockquote>\n<h2><span id=\"druid属性集\">druid属性集</span></h2><p><img src=\"http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203175906.png\" alt></p>\n<h1><span id=\"然后在webxml中修改contextxml的引用方式为\">然后在web.xml中修改context.xml的引用方式为*</span></h1><pre><code>&lt;context-param&gt;\n    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;\n    &lt;param-value&gt;classpath:spring-context*.xml&lt;/param-value&gt;\n&lt;/context-param&gt;</code></pre><h1><span id=\"开启druid监控中心\">开启druid监控中心</span></h1><blockquote>\n<p>将以下配置粘贴到web.xml中</p>\n</blockquote>\n<pre><code>&lt;servlet&gt;\n    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;\n    &lt;servlet-class&gt;com.alibaba.druid.support.http.StatViewServlet&lt;/servlet-class&gt;\n&lt;/servlet&gt;\n&lt;servlet-mapping&gt;\n    &lt;servlet-name&gt;DruidStatView&lt;/servlet-name&gt;\n    &lt;url-pattern&gt;/druid/*&lt;/url-pattern&gt;\n&lt;/servlet-mapping&gt;</code></pre><h1><span id=\"done\">done</span></h1><p><img src=\"http://be-sunshine.cn/wp-content/uploads/2019/02/QQ%E6%88%AA%E5%9B%BE20190203182905.png\" alt></p>\n","categories":[{"name":"Spring","slug":"Spring","count":4,"path":"api/categories/Spring.json"}],"tags":[{"name":"Spring","slug":"Spring","count":6,"path":"api/tags/Spring.json"}]}